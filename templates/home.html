<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="utf-8">
    <title>Restaurant Finder</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/app.css') }}">
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script type="text/javascript">
        function postLocation(lat, lon) {
            var location = {"lat": lat, "lon": lon};
            // $.ajax({
            //     type: "POST",
            //     contentType: "application/json;charset=utf-8",
            //     url: "/getLocation",
            //     traditional: "true",
            //     data: JSON.stringify(location),
            //     dataType: "json"
            // });
            window.location.replace("/restaurant_finder?" + $.param(location));
        }
        function getLocation() {
            /*if ({{ location_received }} == '0') {*/
            // Store the element where the page displays the result
            result = document.getElementById("result");
            // If geolocation is available, try to get the visitor's position
            if(navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(successCallback, errorCallback);
                result.innerHTML = "Getting the position information...";
            } else {
                result.innerHTML = "Sorry, your browser does not support HTML5 geolocation.";
                postLocation(40.730610, -73.935242);
            }
        }
        // Define callback function for successful attempt
		function successCallback(position) {
			result.innerHTML = "Your current position is (" + "Latitude: " + position.coords.latitude + ", " + "Longitude: " + position.coords.longitude + ")";
            postLocation(position.coords.latitude, position.coords.longitude);
		}
		// Define callback function for failed attempt
		function errorCallback(error) {
			if(error.code == 1) {
				result.innerHTML = "You've decided not to share your position, but it's OK. We won't ask you again.";
			} else if(error.code == 2) {
				result.innerHTML = "The network is down or the positioning service can't be reached.";
			} else if(error.code == 3) {
				result.innerHTML = "The attempt timed out before it could get the location data.";
			} else {
				result.innerHTML = "Geolocation failed due to unknown error.";
			}
            postLocation(40.730610, -73.935242);
		}
    </script>
    <script type="text/javascript">
        boxes();
    </script>
    <script type="text/javascript">
        $(document).ready(function boxes(){
            var names = []
            $('#submit').click(function() {
                names.push($('#testbox').val());
                console.log(names);
                $.ajax({
                    type: "POST",
                    contentType: "application/json;charset=utf-8",
                    url: "/test",
                    traditional: "true",
                    data: JSON.stringify({names}),
                    dataType: "json"
                });
            });
        });
    </script>
</head>

<body onload="getLocation()">
  
    <form action="/" method="post" enctype="multipart/form-data">
        <label>Name #1 : </label><input type='textbox' id='testbox' name ='mytext'>
        <input type="submit" value="Submit" id='submit'>
    </form>



    <h1> Welcome to the launch page for my restaurant finder. </h1>
	<p>
        <b> Instructions:</b> Must allow your location, then ...<br>
        (More information about the application)
    </p>
	<!--<a href="{{ url_for('restaurant_finder') }}">Launch Application</a>-->



	<div id="result">
        <!--Position information will be inserted here-->
    </div>
    <button type="button" onclick="getLocation();">Show Position</button>


</body>
</html>